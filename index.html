<script>
var mapTilerKey = 'otxQEa1xT4DzKWLSdyS7';

var map = L.map('map', { center: [31.052, 53.2621], zoom: 10 });

var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

var markers = L.markerClusterGroup();

// لینک CSV
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSge8iyIvBomiIgCEQIv1ctR2Wgll3aGclzzgkbBiJCWE5wgRCE41KDq0uUUU8l0X8IbxDqIFvVlEa0/pub?gid=0&single=true&output=csv";

Papa.parse(csvUrl, {
  download: true,
  header: true,
  complete: function(results) {
    results.data.forEach(function(row) {
      var lat = parseFloat(row["Latitude"]);
      var lon = parseFloat(row["Longitude"]);
      var checked = row["پرسشنامه تکمیل شد"] === "TRUE";

      if (!isNaN(lat) && !isNaN(lon)) {
        var markerColor = checked ? "green" : "red";
        var marker = L.circleMarker([lat, lon], { color: markerColor, radius: 5 })
          .bindPopup(`<b>Well ID:</b> ${row["کد کلاسه"]}<br><b>Checked:</b> ${checked ? "Yes" : "No"}`);
        
        markers.addLayer(marker);
      }
    });

    // افزودن خوشه‌ها به نقشه
    map.addLayer(markers);
    console.log("All markers added.");
  },
  error: function(error) {
    console.error("Error parsing CSV:", error);
  }
});
</script>
