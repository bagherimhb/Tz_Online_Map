<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>هم‌بست آب-انرژی-محیط زیست آبخوان</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>
<style>
/* استایل‌های نقشه و مارکر */
#map {
  width: 100%;
  height: calc(100vh - 150px);
}

#completed-container {
  position: absolute;
  top: 10px;
  left: 10px;
  background-color: white;
  padding: 10px;
  border-radius: 5px;
  z-index: 1002;
  font-size: 14px;
}

#completed-count {
  font-weight: bold;
  color: blue;
}

#search-container {
  position: absolute;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  background-color: white;
  padding: 10px;
  border-radius: 5px;
  z-index: 1002;
}

#search-input {
  width: 200px;
  padding: 5px;
  margin-right: 10px;
}

#search-button, #clear-button {
  padding: 5px 10px;
}

.legend {
  line-height: 18px;
  color: #555;
  background-color: white;
  padding: 6px 8px;
  border-radius: 5px;
}

.legend i {
  width: 14px;
  height: 14px;
  float: left;
  margin-right: 8px;
  opacity: 0.9;
}

#logo {
  position: absolute;
  bottom: 90px;
  right: 10px;
  width: 150px;
  height: auto;
  z-index: 1001;
}
</style>
</head>
<body>

<div id="completed-container">
  <span>تعداد پرسشنامه‌های تکمیل شده تاکنون:</span>
  <span id="completed-count">در حال بارگذاری...</span>
</div>

<div id="search-container">
  <input type="text" id="search-input" placeholder="Enter Well ID" />
  <button id="search-button">Search</button>
  <button id="clear-button">Clear</button>
</div>

<div id="map"></div>
<img id="logo" src="images/waterCo_university.png" alt="Logo" />

<script>
document.addEventListener('DOMContentLoaded', function() {
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSge8iyIvBomiIgCEQIv1ctR2Wgll3aGclzzgkbBiJCWE5wgRCE41KDq0uUUU8l0X8IbxDqIFvVlEa0/pub?gid=0&single=true&output=csv";

  // دریافت تعداد پرسشنامه‌های تکمیل‌شده
  Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(results) {
      const q1Value = results.data[0]["Q1"];
      document.getElementById('completed-count').textContent = q1Value || "نامشخص";
    },
    error: function() {
      document.getElementById('completed-count').textContent = "خطا در بارگذاری";
    }
  });

  // ایجاد نقشه
  var map = L.map('map', {
    center: [31.052, 53.2621],
    zoom: 11
  });

  // افزودن لایه OSM
  var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Developer: MH Bagheri'
  }).addTo(map);

  // افزودن لایه ماهواره‌ای
  var mapTilerKey = 'otxQEa1xT4DzKWLSdyS7';
  var mapTilerSatLayer = L.tileLayer('https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=' + mapTilerKey, {
    tileSize: 512,
    zoomOffset: -1,
    minZoom: 1,
    maxZoom: 19,
    attribution: 'Developer: MH Bagheri',
    crossOrigin: true
  });

  var baseLayers = {
    "OSM": osmLayer,
    "Satellite": mapTilerSatLayer
  };

  L.control.layers(baseLayers).addTo(map);

  // سایر کدها برای بارگذاری لایه‌ها و داده‌ها (مانند shapefile) به صورت مشابه باقی می‌ماند.

  // Event listener برای دکمه Clear
  document.getElementById('clear-button').addEventListener('click', function() {
    document.getElementById('search-input').value = ''; // پاک کردن محتوای کادر جستجو
    map.setView([31.052, 53.2621], 11); // بازنشانی مرکز و زوم نقشه به حالت اولیه
  });
});
</script>
</body>
</html>
